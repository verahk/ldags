



stop()
assignInNamespace("usrDAGcorescore", usrDAGcorescore, ns = "BiDAG")

bn <- readRDS("simulations/asia.rds")
n <- length(bn)
df <- vapply(bnlearn::rbn(bn, 1000), 
             function(x) as.integer(factor(x, exclude = NULL)),
             integer(10**3)) -1
param <- BiDAG::scoreparameters("usr", 
                                 data = df,
                                 usrpar = list(pctesttype = "bdecat",
                                                test = 1))
param$Cvec <- rep(2, 8)
iterativefit <- learnBN(param, algorithm = "orderIter", scoreout = T, verbose = T)
plot(unlist(iterativefit$trace), type = "l")
summary(iterativefit)
iterSpace <- getSpace(iterativefit)

# check scoretable object
adj <- iterativefit$scoretable$adjacency
tab <- iterativefit$scoretable$tables
j <- 1
which(adj[, 1] == 1) 
test <- c(usrDAGcorescore(j, integer(0), n, param), 
          usrDAGcorescore(j, 3, n, param), 
          usrDAGcorescore(j, 7, n, param), 
          usrDAGcorescore(j, c(3, 7), n, param))


setequal(tab[[1]][[1]], test)
fit <- partitionMCMC(param, verbose = T)
fit$score
fit$DAG
tmp <- sapply(seq_along(bn), 
              function(j) BiDAG:::usrDAGcorescore(j, which(fit$DAG[, j] == 1), n = length(bn), param))

fit$traceadd$incidence
